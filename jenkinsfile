

pipeline
{

agent { label 'node1' 
   }

 tools { 
        maven 'MAVEN363' 
        jdk 'java1.8.0' 
    }
parameters{
      string(name: 'IMAGE', defaultValue: 'myimage', description: 'docker image name')
}
  stages {
 
       stage ('git checkout') {
	   
	      steps {
		  
		   git branch: 'develop', url: 'https://github.com/mrudulapolavaram/devopstrainrepo.git'
		   
		   }
		}
		   
		   
		stage ('Initialize') {
            steps {
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                 
          }
		 
	    
	} 
	
	stage ('install') {
            steps {
           				    sh 'mvn install'
			}
            }	
            
     		
    stage ("Build image") {
	       steps{		     
        // download the dockerfile to build from
                // build our docker image
           sh'''
	       cd ${WORKSPACE}
		   echo ${WORKSPACE}
		   echo ${IMAGE}
           docker build . -t ${IMAGE}:${BUILD_NUMBER}
	       '''
		   }
		   }
    stage ("interactive msg") {
	
	  input {
	  
	  message "should we continue with the deployment?"
	  ok "yes,we should"
	  parameters {
	      string(name : 'IMAGED' , defaultValue : 'myimage' , description : 'docker image name')
		  string(name : 'VRSN' , defaultValue : 'v1' , description : 'docker version number')
		  
	    }
		}
	  steps {
	     sh  'docker run -p 8093:8090 ${IMAGED}:${VRSN} '
	  }
	  
	  
	}
	}
}  
